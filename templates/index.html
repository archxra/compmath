<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Компьютерная математика</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        .loading { display: none; }
        .result-box { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0px 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-light">

<div class="container">
    <h2 class="text-center mt-4">Компьютерная математика</h2>

    <label for="taskSelect" class="form-label">Выберите задачу:</label>
    <select id="taskSelect" class="form-select">
        <option value="1">Графический метод</option>
        <option value="2">Методы корней</option>
        <option value="3">Метод релаксации</option>
        <option value="4">Степенной метод</option>
        <option value="5">Экспоненциальная аппроксимация</option>
        <option value="6">Сплайн-интерполяция</option>
        <option value="7">Метод Пикара</option>
        <option value="8">Формула Симпсона</option>
    </select>

    <button id="computeBtn" class="btn btn-primary w-100 mt-3">Вычислить</button>

    <div class="loading text-center mt-3">
        <span class="spinner-border"></span> Выполняется расчет...
    </div>

    <div id="resultBox" class="mt-4 result-box d-none">
        <h5>Результат:</h5>
        <pre id="resultOutput"></pre>
        <img id="resultGraph" class="img-fluid d-none" />
    </div>
</div>

<script>
$(document).ready(function() {
    $("#computeBtn").click(function() {
        $(".loading").show();
        $("#resultBox").addClass("d-none");
        $("#resultGraph").addClass("d-none");

        let taskId = $("#taskSelect").val();
        $.ajax({
            url: "/compute",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ task_id: parseInt(taskId), params: {} }),
            success: function(response) {
                console.log(response); // Проверяем, что получили с сервера
                $(".loading").hide();
                if (response.success) {
                    if (response.result.graph) {
                        $("#resultGraph").attr("src", "data:image/png;base64," + response.result.graph).removeClass("d-none");
                    } else {
                        $("#resultOutput").text(JSON.stringify(response.result, null, 2));
                    }
                    $("#resultBox").removeClass("d-none");
                } else {
                    $("#resultOutput").text("Ошибка: " + response.error);
                }
            }
        });
    });
});
</script>

</body>
</html>
